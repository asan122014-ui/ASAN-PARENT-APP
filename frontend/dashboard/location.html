<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ASAN ‚Äì Ride Location Setup</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <style>
    body { background: #f6f8fc; font-family: 'Inter', Helvetica, Arial, sans-serif; margin: 0;}
    .container { max-width: 480px; margin: 0 auto; padding: 0 0 90px 0; }
    .top-bar { display:flex; align-items:center; justify-content:space-between; margin:0 0 10px;}
    .back-btn {background:#eef2fe; border:none; color:#4068ea; font-size:1.12em; font-weight:600; cursor:pointer; border-radius:14px; padding:8px 22px;}
    .header-center {font-size:2em; font-weight: 700; color: #132263}
    .ask-ai-btn { background: #eef2fe; color: #4068ea; border:none; border-radius:18px; padding:8px 22px; font-size:1.08em; font-weight: 600; cursor:pointer;}
    .stepper { font-size:1em; margin:18px 0 18px 0; color:#7082ab; font-weight:600; display:flex; gap: 20px;}
    .stepper-btn {
      background: none;
      border: none;
      color: #1672ef;
      font-size: 1.05em;
      font-weight: 700;
      padding: 0 6px;
      margin: 0 4px;
      cursor: pointer;
      text-decoration: underline;
    }
    .stepper-btn.active {
      color: #1672ef;
      border-bottom:2px solid #1672ef;
      text-decoration: none;
    }
    .profile-row {display:flex;align-items:center;margin-bottom:7px;}
    .profile-info {margin-left:0;}
    .profile-name {font-weight:700;color:#1a254b;font-size:1.08em;}
    .profile-detail {color:#7082ab;font-size:1em;}
    .trip-type-tag {margin-left:auto;background:#16c772; color:#fff; border-radius:18px; padding:7px 17px; font-weight:700;}
    .location-card {background:#fff; border-radius:18px; box-shadow: 0 4px 14px rgba(75,110,250,0.06); padding:16px 18px 14px 18px; margin-bottom:13px;}
    .pickupdrop-row {display:flex; align-items:center; margin-bottom:16px;}
    .dot {width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:8px;}
    .dot.pickup {background:#236bf9;}
    .dot.drop {background:#ea475c;}
    .location-main {font-size:1.17em;font-weight:700;color:#132263;}
    .edit-inp {font-size:1.13em;padding:3px 10px;border-radius:8px;border:1px solid #e1e6f0;}
    .change-btn {background: #eef2fe; color: #4068ea; border:none;border-radius:13px; padding:8px 18px; font-weight:600; font-size:1em; margin-left:auto;cursor:pointer;}
    .map-card {background:#fff; border-radius:18px; box-shadow: 0 4px 14px rgba(75,110,250,0.06); padding:15px 16px; margin-bottom:15px;}
    #gmap {width:100%;height:210px;border-radius:14px;margin-bottom:13px;}
    .return-card {background:#fff; border-radius:18px; box-shadow: 0 4px 14px rgba(75,110,250,0.06); padding:16px 18px 18px 18px; margin-bottom:13px;}
    .return-top {display:flex; align-items:center; justify-content:space-between;}
    .swap-btn {background: #eef2fe; color:#4068ea; border:none;border-radius:15px;font-weight:600;padding:6px 20px;font-size:1em;}
    .return-row {display:flex;gap:12px;margin-top:15px;}
    .return-loc {flex:1;background:#f8fafd; border-radius:12px;padding:14px 11px;}
    .return-tag-title {color:#7082ab;font-size:.98em;font-weight:600;}
    .return-tag-main {color:#1a254b;font-size:1.1em;font-weight:700;}
    .places-card {background:#fff;border-radius:18px;box-shadow:0 4px 14px rgba(75,110,250,0.06);padding:14px 18px;}
    .places-title-row {display:flex;align-items:center;justify-content:space-between;}
    .places-tags-row {display:flex;gap:12px;margin-top:17px;}
    .place-tag {background:#eef2fe;color:#29457b;border-radius:13px;padding:11px 19px 11px 19px;font-size:1.08em; font-weight:600; display:flex; align-items:center; gap:7px;}
    .add-btn {font-weight:600;font-size:1.3em;background:none;border:none;color:#4068ea;cursor:pointer;}
    .book-ride-btn {width: 100%; background: #1672ef; color: #fff; border: none; border-radius: 25px; padding: 18px 0; font-size: 1.2em; font-weight: 700; cursor: pointer; box-shadow: 0 4px 12px rgba(22, 114, 239, 0.18); margin: 24px 0 8px 0; transition: all 0.2s ease;}
    .book-ride-btn:active { transform: translateY(-2px); }
    .bottom-nav {position:fixed; left:0; right:0; bottom:0; background:#fff; border-top:1px solid #eaeaea; display:flex; justify-content:space-around; align-items:center; height:65px; z-index:10;}
    .nav-btn {display:flex; flex-direction:column; align-items:center; font-size:0.97em; gap:4px; font-weight:600; cursor:pointer; color:#7082ab;}
    .nav-btn.active {color:#1672ef;}
    .nav-btn-icon {font-size:1.7em;}
    @media(max-width:540px) {.container{padding-bottom:90px;}}
  </style>
</head>
<body>
  <div class="container">
    <div class="top-bar">
      <button class="back-btn" onclick="location.href='ride.html'">
        <span class="material-icons" style="vertical-align:middle;font-size:1.12em;margin-right:7px;">arrow_back</span>
        Back
      </button>
      <span class="header-center">New Ride</span>
      <button class="ask-ai-btn" onclick="alert('AI Help')">Ask AI</button>
    </div>
    <div class="stepper">
      <button class="stepper-btn" onclick="location.href='ride.html'">Child</button>
      <button class="stepper-btn active" disabled>Locations</button>
      <button class="stepper-btn" onclick="location.href='schedule.html'">Schedule</button>
      <button class="stepper-btn" onclick="location.href='payment.html'">Payment</button>
    </div>
    <div class="location-card">
      <div class="profile-row">
        <div class="profile-info">
          <div class="profile-name" id="profileName"></div>
          <div class="profile-detail" id="profileDetail"></div>
        </div>
        <span class="trip-type-tag" id="tripTypeTag"></span>
      </div>
      <div class="pickupdrop-row">
        <span class="dot pickup"></span>
        <input id="pickupLocation" class="location-main edit-inp" placeholder="Pickup location" />
        <button class="change-btn" onclick="document.getElementById('pickupLocation').focus()">Edit</button>
      </div>
      <div class="pickupdrop-row">
        <span class="dot drop"></span>
        <input id="dropLocation" class="location-main edit-inp" placeholder="Drop location" />
        <button class="change-btn" onclick="document.getElementById('dropLocation').focus()">Edit</button>
      </div>
    </div>
    <div class="map-card">
      <div style="font-weight:700;font-size:1.22em;color:#14216c;">Map Preview</div>
      <div id="gmap"></div>
    </div>
    <div class="return-card">
      <div class="return-top">
        <span style="font-weight:700;font-size:1.16em;color:#14216c;">Return Trip</span>
        <button class="swap-btn" onclick="swapReturnTrip()">Swap</button>
      </div>
      <div class="return-row">
        <div class="return-loc">
          <div class="return-tag-title">Return pickup</div>
          <div class="return-tag-main" id="returnPickup"></div>
        </div>
        <div class="return-loc">
          <div class="return-tag-title">Return drop</div>
          <div class="return-tag-main" id="returnDrop"></div>
        </div>
      </div>
    </div>
    <div class="places-card">
      <div class="places-title-row">
        <span style="font-weight:700;font-size:1.16em;color:#14216c;">Saved Places</span>
        <button class="add-btn" onclick="addPlacePrompt()">+ Add</button>
      </div>
      <div class="places-tags-row" id="placesTagsRow"></div>
    </div>
    <div style="padding: 24px 0 10px 0;">
      <button class="book-ride-btn" onclick="goToSchedule()">üìç Book Ride</button>
    </div>
  </div>
  <nav class="bottom-nav">
    <div class="nav-btn" onclick="location.href='home.html'">
      <span class="material-icons nav-btn-icon">home</span> Home
    </div>
    <div class="nav-btn active" onclick="location.href='ridesetup.html'">
      <span class="material-icons nav-btn-icon">directions_bus</span> Rides
    </div>
    <div class="nav-btn" onclick="location.href='track.html'">
      <span class="material-icons nav-btn-icon">timeline</span> Track
    </div>
    <div class="nav-btn" onclick="location.href='alerts.html'">
      <span class="material-icons nav-btn-icon">notifications_none</span> Alerts
    </div>
    <div class="nav-btn" onclick="location.href='profile.html'">
      <span class="material-icons nav-btn-icon">person_outline</span> Profile
    </div>
  </nav>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyALwACMYzDkMhWFkrpt5c5cb9MSevkyXdQ"></script>
  <script>
    // Use selectedChild for details
    const child = JSON.parse(localStorage.getItem('selectedChild') || '{}');
    function showChildrenProfile() {
      document.getElementById('profileName').textContent = child.name || 'Unnamed';
      document.getElementById('profileDetail').textContent =
        [child.gender, child.school, child.class ? "Class " + child.class : ""]
          .filter(Boolean)
          .join(' ‚Ä¢ ') || 'Pickup and drop';
      document.getElementById('tripTypeTag').textContent = 'Ride';
    }
    showChildrenProfile();

    let savedPlaces = JSON.parse(localStorage.getItem('placesStack') || '[]');
    document.getElementById('pickupLocation').value = localStorage.getItem('pickupLocation') || '';
    document.getElementById('dropLocation').value = localStorage.getItem('dropLocation') || '';
    document.getElementById('pickupLocation').addEventListener('change', function() {
      localStorage.setItem('pickupLocation', this.value);
      updateReturnTrip();
    });
    document.getElementById('dropLocation').addEventListener('change', function() {
      localStorage.setItem('dropLocation', this.value);
      updateReturnTrip();
    });
    function renderSavedPlaces() {
      const row = document.getElementById('placesTagsRow');
      row.innerHTML = '';
      savedPlaces.forEach((p, idx) => {
        row.innerHTML += `<div class="place-tag"><span class="material-icons">place</span> ${p}</div>`;
      });
    }
    function addPlacePrompt() {
      const name = prompt('Enter name for the saved place:');
      if (!name) return;
      savedPlaces.push(name);
      localStorage.setItem('placesStack', JSON.stringify(savedPlaces));
      renderSavedPlaces();
    }
    renderSavedPlaces();
    function updateReturnTrip() {
      document.getElementById('returnPickup').textContent = document.getElementById('dropLocation').value;
      document.getElementById('returnDrop').textContent = document.getElementById('pickupLocation').value;
    }
    document.getElementById('pickupLocation').addEventListener('input', updateReturnTrip);
    document.getElementById('dropLocation').addEventListener('input', updateReturnTrip);
    function swapReturnTrip() {
      let pickup = document.getElementById('pickupLocation').value;
      let drop = document.getElementById('dropLocation').value;
      document.getElementById('pickupLocation').value = drop;
      document.getElementById('dropLocation').value = pickup;
      localStorage.setItem('pickupLocation', drop);
      localStorage.setItem('dropLocation', pickup);
      updateReturnTrip();
    }
    updateReturnTrip();
    function goToSchedule() {
      window.location.href = 'schedule.html';
    }
    let map;
    function initMap() {
      map = new google.maps.Map(document.getElementById('gmap'), {
        center: {lat:37.7622, lng:-122.4341},
        zoom: 13
      });
    }
    window.onload = initMap;
  </script>
</body>
</html>
